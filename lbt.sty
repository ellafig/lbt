%% lbt.sty   [lua-based-templates]
%% Copyright 2023 Gavin Sinclair
%
% This work may be distributed and/or modified under the
% conditions of the LaTeX Project Public License, either version 1.3c
% of this license or (at your option) any later version.
% The latest version of this license is in
%   http://www.latex-project.org/lppl.txt
% and version 1.3c or later is part of all distributions of LaTeX
% version 2008/05/04 or later.
%
% This work has the LPPL maintenance status `maintained'.
%
% The Current Maintainer of this work is Gavin Sinclair.
%
% This work consists of the files ... (todo)

\NeedsTeXFormat{LaTeX2e}[1999/12/01]
\ProvidesPackage{lbt}
    [2023/12/01 v0.1 Package providing template facilities to ease writing of structured content]

\RequirePackage{luacode}   % and luatextras, etc.?
\RequirePackage{luapackageloader}    % almost certainly needed to load vendored code
\RequirePackage{xcolor}

% Options: draft,nodraft
% \DeclareOption{draft}{\directlua{LBT.api.set_draft_mode(true)}}
% \DeclareOption{nodraft}{\directlua{LBT.api.set_draft_mode(false)}}

\begin{luacode*}
  -- Load penlight libraries from vendor directory.
  package.path = package.path .. ';./vendor/?.lua;./vendor/?/init.lua'
  pl = require("pl.import_into")()
  pl.stringx.import()
  pl.tablex.import()
 
  -- Load lbt module into global variable lbt.
  print("*** Hello from lbt package ***")
  lbt = {}                           -- todo check it doesn't exist already
  require('lbt-0-meta')
  require('lbt-1-init')
  require('lbt-2-util')
  require('lbt-3-fn')
  require('lbt-4-api')
  require('lbt-5-builtin-templates')
  lbt.log("lbt-{0,1,2,3,4,5}.lua files have been loaded")
\end{luacode*}

% Commands and environments to come:
%
% \newenvironment{lbt}
%   {\luaexec{lbt.api.clear_content()}}
%   {\luaexec{lbt.api.emit_tex()}}
%
% \newcommand{\lbtResetChapterCounters}{\luaexec{lbt.api.reset_chapter_counters()}}
